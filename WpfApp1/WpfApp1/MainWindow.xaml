<Window x:Class="WpfApp1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Git 工具管理" Height="700" Width="500"
        MinWidth="500" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        Background="#FAFAFA">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Connection Status -->
            <RowDefinition Height="Auto"/>
            <!-- Input -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="*"/>
            <!-- Status -->
            <RowDefinition Height="Auto"/>
            <!-- Footer: Back button -->
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,20">
            <TextBlock Text="Git 安裝更新工具" FontSize="20" FontWeight="Bold" Foreground="#3F51B5"/>
            <Separator Margin="0,10,0,10"/>
        </StackPanel>
        <TextBlock x:Name="CurrentJsonLabel"
                   Grid.Row="0"
                   Text="目前未載入儲存檔案"
                   Margin="0,45,10,10"
                   Foreground="Gray"
                   FontSize="12"
                   FontStyle="Italic" Grid.RowSpan="2"/>

        <!-- Connection Status Section -->
        <Border Grid.Row="1" Background="#E3F2FD" CornerRadius="5" Padding="10" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="🔗 連線狀態：" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,10,0"/>
                <TextBlock x:Name="txtConnectionStatus" Text="未連線" VerticalAlignment="Center" Margin="0,0,15,0"/>
                <CheckBox x:Name="chkAutoSync" Content="自動同步操作" IsChecked="True" 
                          VerticalAlignment="Center" Margin="0,0,10,0"
                          ToolTip="勾選後，您的操作會自動同步到所有連線的客戶端"/>
                <Button x:Name="btnOpenMultiConnect" Content="開啟連線管理" 
                        Padding="8,4" Click="BtnOpenMultiConnect_Click"
                        Background="#3F51B5" Foreground="White" BorderThickness="0"/>
            </StackPanel>
        </Border>

        <!-- Input Section -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,20">
            <Label Content="指令：" VerticalAlignment="Center" FontSize="14" FontWeight="Medium"/>
            <TextBox x:Name="GitPathTextBox" Width="300" Height="30" Margin="10,0,0,0" Padding="5"
                     BorderBrush="#3F51B5" BorderThickness="1" TextChanged="GitPathTextBox_TextChanged" KeyDown="GitPathTextBox_KeyDown"/>
        </StackPanel>

        <!-- Button Section -->
        <WrapPanel Grid.Row="3" HorizontalAlignment="Center" Margin="0,0,0,20">
            <Button x:Name="InstallGitButton" Content="📥 安裝" Width="150" Height="40" FontSize="14"
                    Background="#4CAF50" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="InstallGit_Click"/>
            <Button x:Name="CheckoutButton" Content="🔄 選場域" Width="150" Height="40" FontSize="14"
                    Background="#2196F3" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="Checkout_Click"/>
            <Button x:Name="UpdateGitButton" Content="⬆️ 更新Kiosk" Width="150" Height="40" FontSize="14"
                    Background="#FF9800" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="UpdateGit_Click"/>
            <Button x:Name="AssembleKioskButton" Content="📦 組裝Kiosk" Width="150" Height="40" FontSize="14"
                    Background="#9C27B0" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="Assemble_Click"/>
            <Button x:Name="AssembleKiosk" Content="📦 一鍵更新" Width="150" Height="40" FontSize="14"
                    Background="Red" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="ALL_Assemble_Click" />
            <Button x:Name="ModifyReg" Content="備份kiosk" Width="150" Height="40" FontSize="14"
                    Background="Gray" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="Backup_Click"/>
            <Button x:Name="modifyconfig" Content="更改kiosk Config" Width="150" Height="40" FontSize="14"
                    Background="pink" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="Modifyconfig_Click"/>
            <Button x:Name="ModifyReg1" Content="更新歷史紀錄" Width="150" Height="40" FontSize="14"
                    Background="DarkGreen" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Margin="5" Click="History_Search"/>
        </WrapPanel>

        <!-- Status Section -->
        <StackPanel Grid.Row="4" Margin="0,20,0,0">
            <TextBlock Text="狀態：" FontSize="14" FontWeight="Bold" Margin="0,0,0,5"/>
            <TextBox x:Name="StatusTextBox" Height="150" TextWrapping="Wrap"
                     IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                     Padding="10" BorderBrush="#BDBDBD" BorderThickness="1"/>
        </StackPanel>

        <!-- 回上一頁 -->
        <StackPanel Orientation="Horizontal"
            Grid.Row="5"
            HorizontalAlignment="Left"
            VerticalAlignment="Bottom"
            Margin="0,10,0,10">

            <Button Content="儲存Config"
            Width="100" Height="30"
            Margin="0,0,10,0"
            Click="SaveCurrentSelection_Click"/>

            <ComboBox x:Name="JsonSelector"
              Width="200" VerticalContentAlignment="Center"
             />
        </StackPanel>

        <!-- 遮罩處理中 -->
        <Grid Name="LoadingOverlay" Background="#AA000000"
              Visibility="Collapsed" Panel.ZIndex="999" Margin="-17,-14,-18,-19" Grid.RowSpan="6">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="處理中，請稍候..." FontSize="16" Foreground="White"/>
                <ProgressBar IsIndeterminate="True" Width="200"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
